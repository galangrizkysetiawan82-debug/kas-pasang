<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kas pagar nusa pisang — Buku Kas</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1020;
      --card:#0f1726;
      --muted:#9aa7bf;
      --accent:#3bd3d6;
      --accent-2:#7c5cff;
      --glass: rgba(255,255,255,0.03);
      --success:#10b981;
      --danger:#ef4444;
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(124,92,255,0.12), transparent),
                  linear-gradient(180deg,#071229 0%, #071022 100%);
      color:#e8f1fb;
      padding:28px;
    }

    .wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns: 380px 1fr;gap:20px;align-items:start}
    @media (max-width:980px){ .wrap{grid-template-columns:1fr} }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
      border-radius:var(--radius);
      padding:18px;
      box-shadow: 0 10px 30px rgba(2,8,23,0.6);
    }

    header.app-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    header.app-header h1{font-size:20px;margin:0}
    header.app-header .sub{color:var(--muted);font-size:13px}

    /* LEFT: form + summary */
    .left .brand{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    .logo{
      width:56px;height:56px;border-radius:12px;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      display:flex;align-items:center;justify-content:center;font-weight:700;color:#041826;
      box-shadow: 0 6px 18px rgba(60,80,120,0.12);
    }
    form {display:grid;grid-template-columns:1fr 1fr;gap:10px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type="text"], input[type="date"], input[type="number"], select {
      width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);
      background:var(--glass);color:inherit;font-size:14px;
    }
    .full{grid-column:1 / -1}
    .btn{
      padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600;
      background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#04263a;
    }
    .muted{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px;align-items:center;margin-top:8px}

    .summary{display:flex;gap:10px;margin-top:14px}
    .summary .item{flex:1;background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;text-align:center}
    .item .title{font-size:12px;color:var(--muted)}
    .item .value{font-size:18px;margin-top:6px}

    /* RIGHT: chart + table */
    .topbar{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:12px}
    .filters{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .pill{background:rgba(255,255,255,0.02);padding:8px;border-radius:999px;font-size:13px;color:var(--muted)}
    table{width:100%;border-collapse:collapse;font-size:13px;margin-top:12px}
    th,td{padding:10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03)}
    th{color:var(--muted);font-size:12px}
    td.right{text-align:right}
    .text-income{color:var(--success);font-weight:700}
    .text-expense{color:var(--danger);font-weight:700}

    .small{font-size:12px;color:var(--muted)}
    .actions-right{display:flex;gap:8px;align-items:center}
    .icon-btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:10px;cursor:pointer;color:var(--muted)}

    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}

  </style>
</head>
<body>
  <div class="wrap">
    <!-- LEFT: input & summary -->
    <div class="card left">
      <div class="brand">
        <div class="logo">PN</div>
        <div>
          <div style="font-weight:700">Kas Pagar Nusa</div>
          <div class="sub">Kas latihan•Membantu anggota</div>
        </div>
      </div>

      <form id="txForm">
        <div>
          <label for="date">Tanggal</label>
          <input id="date" type="date" required />
        </div>
        <div>
          <label for="type">Tipe</label>
          <select id="type">
            <option value="income">Pemasukan</option>
            <option value="expense">Pengeluaran</option>
          </select>
        </div>

        <div class="full">
          <label for="category">Kategori</label>
          <input id="category" type="text" placeholder="Iuran / Donasi / Biaya kegiatan" />
        </div>

        <div>
          <label for="amount">Nominal (Rp)</label>
          <input id="amount" type="number" min="0" step="1" placeholder="10000" required />
        </div>
        <div>
          <label for="note">Keterangan</label>
          <input id="note" type="text" placeholder="Contoh: Donasi" />
        </div>

        <div class="full controls" style="justify-content:space-between">
          <div style="display:flex;gap:8px">
            <button class="btn" type="submit">Tambah Transaksi</button>
            <button id="clearBtn" type="button" class="icon-btn">Bersihkan</button>
          </div>
          <div style="display:flex;gap:8px">
            <button id="exportBtn" type="button" class="icon-btn">Export CSV</button>
            <button id="importBtn" type="button" class="icon-btn">Import CSV</button>
            <input id="fileImport" type="file" accept=".csv" style="display:none" />
          </div>
        </div>
      </form>

      <div class="summary">
        <div class="item">
          <div class="title">Saldo Awal</div>
          <div id="opening" class="value">Rp 0</div>
        </div>
        <div class="item">
          <div class="title">Total Pemasukan</div>
          <div id="totalIncome" class="value text-income">Rp 0</div>
        </div>
        <div class="item">
          <div class="title">Total Pengeluaran</div>
          <div id="totalExpense" class="value text-expense">Rp 0</div>
        </div>
      </div>

      <div style="margin-top:12px" class="small">
        Tip: Data tersimpan di browser (localStorage). Backup dengan Export CSV.
      </div>
    </div>

    <!-- RIGHT: chart + table -->
    <div class="card right">
      <div class="topbar">
        <div class="filters">
          <div class="pill">Tampilkan semua</div>
          <div class="pill small" id="filterRangeLabel">Periode: semua</div>
        </div>
        <div class="actions-right">
          <input id="search" placeholder="Cari kategori atau keterangan..." style="background:var(--glass);border-radius:10px;padding:8px;border:1px solid rgba(255,255,255,0.04);color:inherit" />
          <button id="filterBtn" class="icon-btn">Filter</button>
          <button id="clearFilterBtn" class="icon-btn">Reset Filter</button>
        </div>
      </div>

      <div style="height:260px;">
        <canvas id="chart" style="width:100%;height:100%"></canvas>
      </div>

      <div style="margin-top:12px">
        <table id="txTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Tanggal</th>
              <th>Tipe</th>
              <th>Kategori</th>
              <th>Keterangan</th>
              <th class="right">Nominal</th>
              <th class="right">Aksi</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <footer>
        Dibuat cepat — ubah sesuai kebutuhan organisasi Anda.
      </footer>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // --- Simple kas organisasi app (Single-file) ---
    const LS = 'kas_org_v1';
    const $ = id => document.getElementById(id);

    // elements
    const txForm = $('txForm');
    const dateEl = $('date');
    const typeEl = $('type');
    const categoryEl = $('category');
    const amountEl = $('amount');
    const noteEl = $('note');
    const clearBtn = $('clearBtn');
    const exportBtn = $('exportBtn');
    const importBtn = $('importBtn');
    const fileImport = $('fileImport');
    const searchEl = $('search');
    const filterBtn = $('filterBtn');
    const clearFilterBtn = $('clearFilterBtn');

    const openingEl = $('opening');
    const totalIncomeEl = $('totalIncome');
    const totalExpenseEl = $('totalExpense');
    const txTableBody = document.querySelector('#txTable tbody');
    const filterRangeLabel = $('filterRangeLabel');

    // state
    function loadState(){ try { return JSON.parse(localStorage.getItem(LS)) || {opening:0, transactions:[]} } catch(e){ return {opening:0, transactions:[]} } }
    function saveState(s){ localStorage.setItem(LS, JSON.stringify(s)); }

    function formatRp(n){
      const num = Number(n)||0;
      return 'Rp ' + num.toLocaleString('id-ID');
    }

    function uid(){ return 't'+Date.now().toString(36)+Math.floor(Math.random()*900).toString(36); }

    // default date
    (function setToday(){ const d=new Date(); const yyyy=d.getFullYear(); const mm=String(d.getMonth()+1).padStart(2,'0'); const dd=String(d.getDate()).padStart(2,'0'); dateEl.value = `${yyyy}-${mm}-${dd}` })();

    // render
    let chart=null;
    function render(filter=null){
      const state = loadState();
      // totals (whole dataset)
      let income=0, expense=0;
      state.transactions.forEach(t => { if (t.type==='income') income+=Number(t.amount); else expense+=Number(t.amount) });
      const balance = Number(state.opening) + income - expense;
      openingEl.textContent = formatRp(state.opening);
      totalIncomeEl.textContent = formatRp(income);
      totalExpenseEl.textContent = formatRp(expense);

      // filter
      let rows = state.transactions.slice();
      if (filter){
        if (filter.q) rows = rows.filter(r => (r.category||'').toLowerCase().includes(filter.q.toLowerCase()) || (r.note||'').toLowerCase().includes(filter.q.toLowerCase()));
        if (filter.from) rows = rows.filter(r => r.date >= filter.from);
        if (filter.to) rows = rows.filter(r => r.date <= filter.to);
        if (filter.type && filter.type !== 'all') rows = rows.filter(r => r.type === filter.type);
        filterRangeLabel.textContent = filter.from || filter.to ? `Periode: ${filter.from||'-'} → ${filter.to||'-'}` : 'Periode: semua';
      } else {
        filterRangeLabel.textContent = 'Periode: semua';
      }

      // table
      txTableBody.innerHTML = '';
      rows.slice().reverse().forEach((tx, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${idx+1}</td>
          <td>${tx.date}</td>
          <td>${tx.type === 'income' ? '<span class="text-income">Pemasukan</span>' : '<span class="text-expense">Pengeluaran</span>'}</td>
          <td>${escapeHtml(tx.category||'—')}</td>
          <td>${escapeHtml(tx.note||'—')}</td>
          <td class="right">${formatRp(tx.amount)}</td>
          <td class="right"><button class="icon-btn" data-id="${tx.id}">Hapus</button></td>
        `;
        txTableBody.appendChild(tr);
      });

      // attach delete handlers
      txTableBody.querySelectorAll('button[data-id]').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          if (!confirm('Hapus transaksi ini?')) return;
          const s = loadState();
          s.transactions = s.transactions.filter(t => t.id !== id);
          saveState(s);
          render(filter);
        });
      });

      // chart: per bulan
      const months = {};
      state.transactions.forEach(t => {
        if (!t.date) return;
        const m = t.date.slice(0,7); // YYYY-MM
        if (!months[m]) months[m] = {income:0, expense:0};
        if (t.type === 'income') months[m].income += Number(t.amount);
        else months[m].expense += Number(t.amount);
      });
      const labels = Object.keys(months).sort();
      const incomes = labels.map(l => months[l].income);
      const expenses = labels.map(l => months[l].expense);

      const ctx = document.getElementById('chart').getContext('2d');
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            { label: 'Pemasukan', data: incomes, stack: 's1' },
            { label: 'Pengeluaran', data: expenses, stack: 's1' }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true, ticks: { callback: val => 'Rp ' + val.toLocaleString() } }
          },
          plugins: { legend: { labels: { boxWidth:12 } } }
        }
      });
    }

    // helpers
    function escapeHtml(s){
      if (!s) return '';
      return String(s).replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch]));
    }

    // add tx
    txForm.addEventListener('submit', e => {
      e.preventDefault();
      const date = dateEl.value;
      const type = typeEl.value;
      const category = categoryEl.value.trim();
      const note = noteEl.value.trim();
      const amount = Math.max(0, Number(amountEl.value) || 0);
      if (!date || amount <= 0) { alert('Isi tanggal dan nominal dengan benar.'); return; }
      const s = loadState();
      s.transactions.push({ id: uid(), date, type, category, note, amount });
      saveState(s);
      txForm.reset();
      // set today again
      (function setToday(){ const d=new Date(); const yyyy=d.getFullYear(); const mm=String(d.getMonth()+1).padStart(2,'0'); const dd=String(d.getDate()).padStart(2,'0'); dateEl.value = `${yyyy}-${mm}-${dd}` })();
      render();
    });

    clearBtn.addEventListener('click', () => {
      if (!confirm('Kosongkan form?')) return;
      txForm.reset();
      (function setToday(){ const d=new Date(); const yyyy=d.getFullYear(); const mm=String(d.getMonth()+1).padStart(2,'0'); const dd=String(d.getDate()).padStart(2,'0'); dateEl.value = `${yyyy}-${mm}-${dd}` })();
    });

    // export CSV
    exportBtn.addEventListener('click', () => {
      const s = loadState();
      const rows = [['id','date','type','category','note','amount']];
      s.transactions.forEach(t => rows.push([t.id, t.date, t.type, (t.category||''), (t.note||''), t.amount]));
      const csv = rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'kas_organisasi_export.csv';
      document.body.appendChild(link);
      link.click();
      link.remove();
    });

    // import CSV
    importBtn.addEventListener('click', () => fileImport.click());
    fileImport.addEventListener('change', e => {
      const f = e.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        const text = reader.result;
        const lines = text.split(/\r?\n/).filter(l => l.trim());
        if (lines.length <= 1) { alert('CSV kosong atau tidak valid'); return; }
        const headers = lines[0].split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(h => h.replace(/^"|"$/g,'').trim());
        const parsed = [];
        for (let i=1;i<lines.length;i++){
          const cols = lines[i].split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c => c.replace(/^"|"$/g,''));
          const obj = {};
          headers.forEach((h,idx) => obj[h] = cols[idx] || '');
          parsed.push(obj);
        }
        if (!parsed.length) { alert('Tidak ada data untuk di-import'); return; }
        const s = loadState();
        parsed.forEach(p => {
          s.transactions.push({
            id: p.id || uid(),
            date: p.date || new Date().toISOString().slice(0,10),
            type: p.type || 'income',
            category: p.category || '',
            note: p.note || '',
            amount: Number(p.amount) || 0
          });
        });
        saveState(s);
        alert('Import selesai: ' + parsed.length + ' baris');
        render();
      };
      reader.readAsText(f, 'utf-8');
      fileImport.value = '';
    });

    // simple filters & search
    let currentFilter = null;
    filterBtn.addEventListener('click', () => {
      const q = searchEl.value.trim();
      // show prompt for date range & type for simplicity
      const from = prompt('Dari tanggal (YYYY-MM-DD) — kosong = semua', '') || '';
      const to = prompt('Sampai tanggal (YYYY-MM-DD) — kosong = semua', '') || '';
      const type = prompt('Tipe (all/income/expense) — default all', 'all') || 'all';
      currentFilter = { q: q || '', from: from || null, to: to || null, type: type || 'all' };
      render(currentFilter);
    });

    clearFilterBtn.addEventListener('click', () => {
      currentFilter = null;
      searchEl.value = '';
      render();
    });

    // init
    (function init(){
      // ensure structure
      const s = loadState();
      if (!Array.isArray(s.transactions)) s.transactions = [];
      if (typeof s.opening === 'undefined') s.opening = 0;
      saveState(s);
      render();
    })();
  </script>
</body>
</html>



